\documentclass[a4paper,11pt]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage{hyperref}


\title{The WS\_2017 protocol}
\author{Max Hackinger}

\begin{document}

\maketitle
\tableofcontents
\clearpage

\begin{abstract}
This document will Introduce and define the WS\_2017 protocol.
The WS\_2017 protocol uses the \href{https://tools.ietf.org/html/rfc1939}{POP3 protocol} as a reference.
\end{abstract}

\section{Session States}
The session states in the current draft are directly lifted from the POP3 protocol.\\\\
The session goes through several states during it's life time. After the TCP connection is established and the server sends a greeting and the session enters the AUTHORIZATION state. By transmitting a user name to the server with the \textbf{uname} command the client authorizes it's self and the session can advance to the TRANSACTION state. In the TRANSACTION state the client can execute commands till the client sends the \textbf{cquit} command, that then moves the session in to the UPDATE state. In this state the server releases all resources from the TRANSACTION state and says goodbye and the TCP connection is closed.

\section{Basic Overview}
The WS\_2017 service is started by the server listening to port 1030. To start a session the client establishes a TCP connection with the server and the server sends a greeting to the client. Commands are exchanged between the client and server till the connection is closed or aborted.

\section{Commands}
All commands are case insensitive and made up entirely of ASCII characters. Commands always have exactly one \textbf{keyword} followed by none or more \textbf{arguments}. The keyword is never longer then 5 characters. Commands are always terminated with a CRCF (Carriage Return: \textbackslash r, New Line: \textbackslash n). Commands will either be answered with a positive response confirming that the command has been understood and processed or negative response pointing out what is wrong.\\
A positive response has a '+OK' followed by the command that was successful. A negative response has a '-ERR' followed by the command that failed and an argument that either is a message with what went wrong or a suggestion for change that is relevant to the keyword.\\
If the entered command is badly formatted the Server should return:
\begin{quote}\
  s: -ERR '<command> is not a properly formatted command'
\end{quote}
If the entered command does not match a valid command, the server should return:
\begin{quote}\
  s: -ERR 'entered command does not exist'
\end{quote}
\clearpage

\section{AUTHORIZATION State Commands}
% Once the session has gone in to the AUTHORIZATION state, the server will be expecting user name to identify the client by. If the server recognizes it as a user name that has already been used before and the IP address is the same as the client that last used it, it will return a positive message and all relevant information for the client. If it is a new name the server will create a new entry in the list of names. If the name is a previously used name and the IP address does not match, the server will return negative message with a suggested new name. 
% To change a name the user can use the same command to change the old name to the new name. The same answers apply here. If the user enters the name it already had it returns a negative message.\\\\
% registering a user name:
% \begin{quote}
%   c: uname '<name>'\\
%   s: +OK 'you are <name>'
% \end{quote}
% \noindent
% recognizing client:
% \begin{quote}
%   c: uname '<name>'\\
%   s: +OK 'welcome back <name>'
% \end{quote}
% \noindent
% username already taken:
% \begin{quote}
%   c: uname '<name>'\\
%   s: -ERR uname '<name\_suggestion>'
% \end{quote}
%
%
% \noindent
Once the session has gone in to the AUTHORIZATION state, the server will be expecting user name to identify the client by. This is done by sending a message with the desired user name to the server. If the name is already present in the server (i.e there is already a client connected with that name), the server returns a negative response. If the name given to the server is unique the server confirms it with a positive response. As soon as the client has entered the user name, it is broadcasted to all other connected clients.\\ 
When a user disconnects from the server the user name is removed.\\\\
registering a name:

\begin{quote}
  c: uname <name>\\
  s: +OK 'you are' <name>
\end{quote}
\noindent
own username entered:
\begin{quote}
  c: uname <name>\\
  s: -ERR 'same username entered'
\end{quote}
\noindent
username already taken:
\begin{quote}
  c: uname <name>\\
  s: -ERR uname <name\_suggestion>
\end{quote}
\noindent
broadcast new user name to other clients:
\begin{quote}
  s: nuser <name>
\end{quote}


\clearpage
\section{TRANSACTION State Commands}
\subsection{Ping/Pong}
in regular intervals server and client should exchange pings to make sure that they are still connected, if there is no response in a defined time the connection should be disconnected.\\\\
\noindent
server sends ping:
\begin{quote}
  s: cping\\
  c: +OK cpong
\end{quote}

\subsection{Changing user name}
To change user name the same command is used as to enter the original user name in the AUTHORIZATION State.\\
change name:
\begin{quote}
  c: uname <new\_name>
  s: +OK uname <new\_name>
\end{quote}
\noindent
When the a name is changed this has to be sent to all other clients:\\
\begin{quote}
  s: +OK nuser <old\_name> <new\_name>
\end{quote}
\noindent
(actully part of the AUTHORIZATION State)When a user joins the server the name is announced to all users
\begin{quote}
  s: nuser <newusername> 
\end{quote}

%%\subsubsection{Chat Room}

\subsection{Get all user names}
To be able to send a message or find to an other user one needs to know the name of the other users.
\begin{quote}
  c: cgetu\\
  s: +OK cgetu <user0> <user2> <user2> ...
\end{quote} 
\subsection{Chat}
When chatting, the server acts as a relay between two clients. When the message arrives at the destination client, the recipient automatically sends back a message (with the chatr command) to the server that then relays a message to the sending client that the message was received.\\\\
sender:
\begin{quote}
  c: chatm '<sender\_name>' '<recipient\_name>' '<message>'\\ %% chatm = chat message
  s: +OK 'message relayed'
\end{quote}
\noindent
recipient:
\begin{quote}
  s: chatm <sender\_name> <recipient\_name> '<message>'\\
  c: chatr <sender\_name> <recipient\_name>%%chat response tells the server that client got message from chat partner
\end{quote}

\clearpage
\section{UPDATE State Commands}
\subsection{Quit}
When the client wants to terminate the connection to the server, the client uses the quit command which leads the session from the TRANSACTION state to the UPDATE state. In this state the server ends tasks related to the client in a safe manner.

\begin{quote}
  c: cquit\\
  s: +OK 'terminating tasks and disconnecting'
\end{quote}


\end{document}
